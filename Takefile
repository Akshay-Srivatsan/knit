set version [trim [shell "cd tools/version; go run version.go"]]
set goflags "-trimpath -ldflags \"-s -w -X github.com/zyedidia/take/info.Version=$version\""

rules {

take:
    go build $goflags
build:V: take

install:V:
    go install $goflags

all:V: take-$version-linux-amd64.tar.gz \
       take-$version-linux-386.tar.gz \
       take-$version-linux-arm.tar.gz \
       take-$version-linux-arm64.tar.gz \
       take-$version-darwin-amd64.tar.gz \
       take-$version-darwin-arm64.tar.gz \
       take-$version-openbsd-amd64.tar.gz \
       take-$version-freebsd-amd64.tar.gz \
       take-$version-windows-amd64.tar.gz

(take-$version-(.*)-(.*)).tar.gz:R:
    mkdir -p $stem1
    GOOS=$stem2 GOARCH=$stem3 go build -o $stem1/take
    cp LICENSE* $stem1
    cp README.md $stem1
    tar czf $out $stem1
    rm -rf $stem1

clean:V:
    rm -f *.tar.gz
    rm -f take

}
